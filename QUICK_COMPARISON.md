# ä¸¤ç§MapTRé›†æˆæ–¹å¼å¯¹æ¯”

## ğŸ¯ æ ¸å¿ƒåŒºåˆ«

ä½ ç°åœ¨æœ‰**ä¸¤ç§æ–¹å¼**å°†å†—ä½™åº¦åˆ’åˆ†ç»“æœç”¨äºMapTRï¼š

| å¯¹æ¯”é¡¹ | æ–¹å¼1ï¼šå®Œæ•´ç‰ˆæœ¬â­ | æ–¹å¼2ï¼šç´¢å¼•æ–‡ä»¶ |
|--------|------------------|----------------|
| **ç”Ÿæˆå†…å®¹** | å®Œæ•´çš„v1.0-xxxç›®å½•ç»“æ„ | ä»…pklç´¢å¼•æ–‡ä»¶ |
| **åŒ…å«æ–‡ä»¶** | sample.jsonç­‰æ‰€æœ‰å…ƒæ•°æ® | nuscenes_infos_temporal_*.pkl |
| **data_root** | æŒ‡å‘æ–°ç‰ˆæœ¬ç›®å½• | ä»æŒ‡å‘åŸå§‹nuscenes |
| **ann_file** | è‡ªåŠ¨åŒ¹é… | éœ€è¦ç‰¹åˆ«æŒ‡å®š |
| **ç©ºé—´å ç”¨** | ~100MBï¼ˆç¬¦å·é“¾æ¥ï¼‰ | ~200MB |
| **åˆ›å»ºæ—¶é—´** | 5-10åˆ†é’Ÿ | 1-2åˆ†é’Ÿ |
| **ä½¿ç”¨æ–¹å¼** | ç›´æ¥ä½œä¸ºç‹¬ç«‹æ•°æ®é›† | éœ€é…åˆåŸå§‹æ•°æ® |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­â­ |

---

## ğŸ“‹ æ–¹å¼1ï¼šåˆ›å»ºå®Œæ•´ç‰ˆæœ¬ï¼ˆæ¨èï¼‰

### ç”Ÿæˆæ–¹å¼

```bash
cd /data2/file_swap/sh_space/nuscenes_NewSplit

# æ–¹æ³•Aï¼šä½¿ç”¨è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰
./create_versions.sh

# æ–¹æ³•Bï¼šå‘½ä»¤è¡Œ
python create_nuscenes_version.py --create-both
```

### ç”Ÿæˆå†…å®¹

```
nuscenes_versions/
â”œâ”€â”€ v1.0-high-redundancy/          # å®Œæ•´çš„é«˜å†—ä½™åº¦ç‰ˆæœ¬
â”‚   â”œâ”€â”€ sample.json                # 8,845 samples
â”‚   â”œâ”€â”€ scene.json
â”‚   â”œâ”€â”€ sample_data.json
â”‚   â”œâ”€â”€ ego_pose.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ v1.0-low-redundancy/           # å®Œæ•´çš„ä½å†—ä½™åº¦ç‰ˆæœ¬
â”‚   â”œâ”€â”€ sample.json                # 18,230 samples
â”‚   â””â”€â”€ ...
â”œâ”€â”€ samples/ â†’ ç¬¦å·é“¾æ¥
â”œâ”€â”€ sweeps/ â†’ ç¬¦å·é“¾æ¥
â””â”€â”€ maps/ â†’ ç¬¦å·é“¾æ¥
```

### MapTRé…ç½®

```python
# ç›´æ¥è®¾ç½®data_root
data_root = './nuscenes_versions/v1.0-low-redundancy/'

data = dict(
    train=dict(
        data_root=data_root,  # ä½¿ç”¨æ–°ç‰ˆæœ¬
        ann_file=data_root + 'nuscenes_infos_temporal_train.pkl',
    ),
)
```

### ä¼˜ç‚¹
- âœ… å®Œæ•´çš„NuScenesæ ‡å‡†ç»“æ„
- âœ… å¯ä»¥ç›´æ¥ä½œä¸ºç‹¬ç«‹æ•°æ®é›†
- âœ… ä¾¿äºç‰ˆæœ¬ç®¡ç†å’Œè¿ç§»
- âœ… ç¬¦åˆNuSceneså®˜æ–¹æ ¼å¼
- âœ… ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼Œå‡ ä¹ä¸å é¢å¤–ç©ºé—´

### ç¼ºç‚¹
- âŒ éœ€è¦é¢å¤–çš„åˆ›å»ºæ­¥éª¤
- âŒ è¿˜éœ€è¦è¿è¡ŒMapTRçš„create_data.pyç”Ÿæˆpkl

---

## ğŸ“‹ æ–¹å¼2ï¼šä»…ç”Ÿæˆç´¢å¼•æ–‡ä»¶

### ç”Ÿæˆæ–¹å¼

```bash
cd /data2/file_swap/sh_space/nuscenes_NewSplit

# æ–¹æ³•Aï¼šä½¿ç”¨è„šæœ¬
./generate_maptr_data.sh

# æ–¹æ³•Bï¼šå‘½ä»¤è¡Œ
python maptr_adapter.py --mode low_only
```

### ç”Ÿæˆå†…å®¹

```
maptr_low_redundancy/
â”œâ”€â”€ nuscenes_infos_temporal_train.pkl    # ç´¢å¼•æ–‡ä»¶
â”œâ”€â”€ nuscenes_infos_temporal_val.pkl      # ç´¢å¼•æ–‡ä»¶
â””â”€â”€ maptr_split_report.txt               # æŠ¥å‘Š
```

### MapTRé…ç½®

```python
# data_rootä»æŒ‡å‘åŸå§‹æ•°æ®
data_root = 'data/nuscenes/'

data = dict(
    train=dict(
        data_root=data_root,  # åŸå§‹æ•°æ®
        ann_file='/path/to/maptr_low_redundancy/nuscenes_infos_temporal_train.pkl',  # æ–°ç´¢å¼•
    ),
)
```

### ä¼˜ç‚¹
- âœ… ç”Ÿæˆé€Ÿåº¦å¿«
- âœ… å ç”¨ç©ºé—´å°
- âœ… ä¸éœ€è¦é¢å¤–æ­¥éª¤

### ç¼ºç‚¹
- âŒ éœ€è¦ä¿®æ”¹é…ç½®æŒ‡å®šann_file
- âŒ ä¸æ˜¯æ ‡å‡†NuScenesç»“æ„
- âŒ data_rootå¿…é¡»æŒ‡å‘åŸå§‹æ•°æ®

---

## ğŸ¤” å¦‚ä½•é€‰æ‹©ï¼Ÿ

### é€‰æ‹©æ–¹å¼1ï¼ˆå®Œæ•´ç‰ˆæœ¬ï¼‰å¦‚æœä½ ï¼š
1. âœ… éœ€è¦é•¿æœŸä½¿ç”¨è¿™ä¸ªå­é›†
2. âœ… å¸Œæœ›æœ‰æ¸…æ™°çš„ç‰ˆæœ¬ç®¡ç†
3. âœ… éœ€è¦åœ¨å¤šä¸ªé¡¹ç›®ä¸­ä½¿ç”¨
4. âœ… æƒ³è¦æ ‡å‡†çš„NuScenesæ ¼å¼
5. âœ… è®¡åˆ’åˆ†äº«ç»™ä»–äººä½¿ç”¨

### é€‰æ‹©æ–¹å¼2ï¼ˆç´¢å¼•æ–‡ä»¶ï¼‰å¦‚æœä½ ï¼š
1. âœ… åªæ˜¯å¿«é€Ÿå®éªŒéªŒè¯
2. âœ… ä¸€æ¬¡æ€§ä½¿ç”¨
3. âœ… ä¸æƒ³æ”¹åŠ¨åŸå§‹æ•°æ®ç»“æ„
4. âœ… ç¡¬ç›˜ç©ºé—´éå¸¸æœ‰é™

---

## ğŸ“Š å®é™…å¯¹æ¯”

### ä½ çš„æ•°æ®

æ ¹æ®å†—ä½™åº¦åˆ†æç»“æœï¼š

| ç‰ˆæœ¬ | Samples | Scenes | å æ¯” |
|------|---------|--------|------|
| åŸå§‹æ•°æ® | 34,149 | 850 | 100% |
| é«˜å†—ä½™åº¦ | 8,845 | 220 | 26% |
| ä½å†—ä½™åº¦ | 18,230 | 454 | 53% |

### è®­ç»ƒæ—¶é—´é¢„ä¼°

| æ•°æ®é›† | æ¯epochæ—¶é—´ | æ€»è®­ç»ƒæ—¶é—´ |
|--------|------------|-----------|
| å…¨é‡æ•°æ® | 100% | 100% |
| ä½å†—ä½™åº¦ | ~53% | **â†“47%** |
| é«˜å†—ä½™åº¦ | ~26% | **â†“74%** |

---

## ğŸš€ æ¨èå·¥ä½œæµ

### æ–¹æ¡ˆAï¼šå®Œæ•´ç‰ˆæœ¬ï¼ˆæ¨èï¼‰â­

```bash
# 1. åˆ†æå†—ä½™åº¦
python split_by_redundancy.py

# 2. åˆ›å»ºå®Œæ•´ç‰ˆæœ¬
./create_versions.sh
# é€‰æ‹©ï¼š3) åŒæ—¶åˆ›å»ºä¸¤ä¸ªç‰ˆæœ¬

# 3. ç”ŸæˆMapTRç´¢å¼•ï¼ˆåœ¨MapTRç›®å½•ä¸­ï¼‰
cd /path/to/MapTR
python tools/create_data.py nuscenes \
    --root-path /path/to/nuscenes_versions/v1.0-low-redundancy \
    --out-dir /path/to/nuscenes_versions/v1.0-low-redundancy \
    --extra-tag nuscenes \
    --version v1.0-low-redundancy

# 4. ä¿®æ”¹é…ç½®
# data_root = './nuscenes_versions/v1.0-low-redundancy/'

# 5. è®­ç»ƒ
./tools/dist_train.sh config.py 8
```

### æ–¹æ¡ˆBï¼šç´¢å¼•æ–‡ä»¶ï¼ˆå¿«é€Ÿï¼‰

```bash
# 1. åˆ†æå†—ä½™åº¦
python split_by_redundancy.py

# 2. ç”ŸæˆMapTRç´¢å¼•
./generate_maptr_data.sh
# é€‰æ‹©ï¼š1) ä»…ä½å†—ä½™åº¦æ•°æ®

# 3. ä¿®æ”¹é…ç½®
# data_root = 'data/nuscenes/'
# ann_file = '/path/to/maptr_low_redundancy/nuscenes_infos_temporal_train.pkl'

# 4. è®­ç»ƒ
./tools/dist_train.sh config.py 8
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å»ºè®®ï¼šä½¿ç”¨æ–¹å¼1ï¼ˆå®Œæ•´ç‰ˆæœ¬ï¼‰

**åŸå› **ï¼š
1. æ›´æ¸…æ™°çš„ç‰ˆæœ¬ç®¡ç†
2. ç¬¦åˆNuScenesæ ‡å‡†æ ¼å¼
3. ä¾¿äºåœ¨å¤šä¸ªå®éªŒä¸­å¤ç”¨
4. æ˜“äºåˆ†äº«å’Œè¿ç§»
5. å‡ ä¹ä¸å é¢å¤–ç©ºé—´ï¼ˆç¬¦å·é“¾æ¥ï¼‰

### ä½•æ—¶ä½¿ç”¨æ–¹å¼2

ä»…å½“ä½ éœ€è¦ï¼š
- å¿«é€ŸéªŒè¯ä¸€ä¸ªæƒ³æ³•
- ä¸´æ—¶æµ‹è¯•
- ä¸éœ€è¦ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†

---

## ğŸ“ ç¤ºä¾‹åœºæ™¯

### åœºæ™¯1ï¼šå¯¹æ¯”å®éªŒ

ä½¿ç”¨æ–¹å¼1åˆ›å»ºå¤šä¸ªç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”ï¼š

```bash
# åˆ›å»ºä¸‰ä¸ªç‰ˆæœ¬
python create_nuscenes_version.py \
    --output-dataroot ./nuscenes_versions \
    --create-both

# åˆ†åˆ«è®­ç»ƒå¯¹æ¯”
# ç‰ˆæœ¬1ï¼šé«˜å†—ä½™åº¦
# ç‰ˆæœ¬2ï¼šä½å†—ä½™åº¦
# ç‰ˆæœ¬3ï¼šåŸå§‹å…¨é‡ï¼ˆbaselineï¼‰
```

### åœºæ™¯2ï¼šå¿«é€ŸéªŒè¯

ä½¿ç”¨æ–¹å¼2å¿«é€Ÿæµ‹è¯•ï¼š

```bash
# åªç”Ÿæˆç´¢å¼•
python maptr_adapter.py --mode low_only

# ä¿®æ”¹é…ç½®
# è®­ç»ƒæµ‹è¯•
```

---

## ğŸ‰ æ€»ç»“

**æ¨èä½¿ç”¨æ–¹å¼1ï¼ˆå®Œæ•´ç‰ˆæœ¬ï¼‰** ğŸŒŸ

å®ƒæä¾›äº†æ›´å¥½çš„ï¼š
- ç‰ˆæœ¬ç®¡ç†
- å¯ç»´æŠ¤æ€§
- å¯å¤ç°æ€§
- æ ‡å‡†åŒ–

ç°åœ¨ä½ å¯ä»¥ï¼š

```bash
# ä¸€é”®åˆ›å»ºå®Œæ•´ç‰ˆæœ¬
cd /data2/file_swap/sh_space/nuscenes_NewSplit
./create_versions.sh
```

è¯¦ç»†æ–‡æ¡£ï¼š
- ğŸ“„ [CREATE_FULL_VERSION.md](CREATE_FULL_VERSION.md) - å®Œæ•´ç‰ˆæœ¬è¯¦ç»†æŒ‡å—
- ğŸ“„ [HOW_TO_USE_WITH_MAPTR.md](HOW_TO_USE_WITH_MAPTR.md) - ç´¢å¼•æ–‡ä»¶ä½¿ç”¨è¯´æ˜

